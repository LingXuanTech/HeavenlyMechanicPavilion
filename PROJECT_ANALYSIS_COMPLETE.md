
# HeavenlyMechanicPavilion (TradingAgents) å®Œæ•´é¡¹ç›®æ¢³ç†æŠ¥å‘Š

## ğŸ“‹ æ‰§è¡Œæ‘˜è¦

**TradingAgents** æ˜¯ä¸€ä¸ªä¼ä¸šçº§çš„ AI é©±åŠ¨é‡‘èäº¤æ˜“æ¡†æ¶ï¼Œé‡‡ç”¨å¤šæ™ºèƒ½ä½“åä½œæ¶æ„ï¼Œç»“åˆ LangGraph ç¼–æ’ã€FastAPI æœåŠ¡å±‚å’Œ Next.js æ§åˆ¶ä¸­å¿ƒï¼Œå®ç°äº†ä»å¸‚åœºç ”ç©¶åˆ°äº¤æ˜“æ‰§è¡Œçš„å®Œæ•´è‡ªåŠ¨åŒ–æµç¨‹ã€‚

### å…³é”®æŒ‡æ ‡
- **ä»£ç åº“è§„æ¨¡**: ~50,000 è¡Œä»£ç 
- **æŠ€æœ¯æ ˆ**: Python 3.10+ / TypeScript / Next.js 14
- **æ¶æ„æ¨¡å¼**: Monorepo + å¾®æœåŠ¡ + æ’ä»¶ç³»ç»Ÿ
- **AI æ™ºèƒ½ä½“**: 12+ ä¸“ä¸šè§’è‰²
- **æ•°æ®æº**: 8+ å¸‚åœºæ•°æ®ä¾›åº”å•†
- **LLM æ”¯æŒ**: 5 ä¸ªä¸»æµæä¾›å•†
- **æµ‹è¯•è¦†ç›–**: ~60% (ç›®æ ‡ 80%)

---

## ğŸ¯ é¡¹ç›®ä»·å€¼ä¸»å¼ 

### 1. æŠ€æœ¯åˆ›æ–°
- âœ… **AI æ™ºèƒ½ä½“ç¼–æ’**: é¦–ä¸ªä½¿ç”¨ LangGraph çš„é‡‘èäº¤æ˜“ç³»ç»Ÿ
- âœ… **æ’ä»¶åŒ–æ¶æ„**: å®Œå…¨å¯æ‰©å±•çš„æ™ºèƒ½ä½“å’Œæ•°æ®æºç³»ç»Ÿ
- âœ… **å®æ—¶æµå¤„ç†**: SSE/WebSocket å®æ—¶æ•°æ®æ¨é€
- âœ… **ç±»å‹å®‰å…¨**: å‰åç«¯å®Œå…¨ç±»å‹åŒ–

### 2. ä¸šåŠ¡ä»·å€¼
- ğŸ“Š **è‡ªåŠ¨åŒ–ç ”ç©¶**: å¤šç»´åº¦å¸‚åœºåˆ†æè‡ªåŠ¨åŒ–
- ğŸ¤– **AI å†³ç­–æ”¯æŒ**: åŸºäºè¯æ®çš„äº¤æ˜“å»ºè®®
- âš¡ **å¿«é€Ÿè¿­ä»£**: çƒ­é‡è½½é…ç½®ï¼Œæ— éœ€é‡å¯
- ğŸ“ˆ **å›æµ‹éªŒè¯**: å†å²æ•°æ®ç­–ç•¥éªŒè¯

### 3. å·¥ç¨‹è´¨é‡
- ğŸ—ï¸ **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„å…³æ³¨ç‚¹åˆ†ç¦»
- ğŸ§ª **æµ‹è¯•é©±åŠ¨**: å•å…ƒ/é›†æˆ/E2E æµ‹è¯•è¦†ç›–
- ğŸ“š **æ–‡æ¡£å®Œå–„**: 15+ ä¸“ä¸šæ–‡æ¡£é¡µé¢
- ğŸ³ **ç”Ÿäº§å°±ç»ª**: Docker å®¹å™¨åŒ–éƒ¨ç½²

---

## ğŸ›ï¸ æ ¸å¿ƒæ¶æ„åˆ†æ

### ç³»ç»Ÿåˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ–¥ï¸  è¡¨ç°å±‚ (Presentation Layer)                         â”‚
â”‚  â€¢ Next.js Web UI (React 18 + Tailwind)                â”‚
â”‚  â€¢ CLI å·¥å…· (Rich + Questionary)                        â”‚
â”‚  â€¢ REST/SSE/WebSocket API                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”§  åº”ç”¨å±‚ (Application Layer)                          â”‚
â”‚  â€¢ FastAPI è·¯ç”±å’Œç«¯ç‚¹                                    â”‚
â”‚  â€¢ è®¤è¯å’Œæˆæƒä¸­é—´ä»¶                                      â”‚
â”‚  â€¢ è¯·æ±‚éªŒè¯å’Œåºåˆ—åŒ–                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¼  ä¸šåŠ¡é€»è¾‘å±‚ (Business Logic Layer)                   â”‚
â”‚  â€¢ TradingGraphService (LangGraph ç¼–æ’)                â”‚
â”‚  â€¢ ExecutionService (äº¤æ˜“æ‰§è¡Œ)                          â”‚
â”‚  â€¢ RiskManagementService (é£é™©ç®¡ç†)                     â”‚
â”‚  â€¢ MarketDataService (å¸‚åœºæ•°æ®)                         â”‚
â”‚  â€¢ SessionEventManager (äº‹ä»¶ç®¡ç†)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¤–  æ™ºèƒ½ä½“ç¼–æ’å±‚ (Agent Orchestration Layer)           â”‚
â”‚  â€¢ LangGraph çŠ¶æ€æœº                                      â”‚
â”‚  â€¢ 12+ ä¸“ä¸šæ™ºèƒ½ä½“èŠ‚ç‚¹                                    â”‚
â”‚  â€¢ æ™ºèƒ½ä½“é—´æ¶ˆæ¯ä¼ é€’                                      â”‚
â”‚  â€¢ å‘é‡è®°å¿†æ£€ç´¢ (ChromaDB)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”Œ  æ’ä»¶ç”Ÿæ€å±‚ (Plugin Ecosystem Layer)                â”‚
â”‚  â€¢ Agent Plugins (12+ è§’è‰²)                            â”‚
â”‚  â€¢ Vendor Plugins (8+ æ•°æ®æº)                          â”‚
â”‚  â€¢ LLM Providers (5 æä¾›å•†)                            â”‚
â”‚  â€¢ Broker Adapters (æ¨¡æ‹Ÿ/å®ç›˜)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š  æ•°æ®è®¿é—®å±‚ (Data Access Layer)                      â”‚
â”‚  â€¢ Repository Pattern (ç±»å‹åŒ– CRUD)                    â”‚
â”‚  â€¢ Database Manager (è¿æ¥æ± )                           â”‚
â”‚  â€¢ Cache Service (Redis)                               â”‚
â”‚  â€¢ Migration System (Alembic)                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ’¾  æŒä¹…åŒ–å±‚ (Persistence Layer)                        â”‚
â”‚  â€¢ PostgreSQL (ä¸»æ•°æ®åº“)                                â”‚
â”‚  â€¢ Redis (ç¼“å­˜ + Pub/Sub)                              â”‚
â”‚  â€¢ ChromaDB (å‘é‡å­˜å‚¨)                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…³é”®è®¾è®¡æ¨¡å¼

#### 1. æ’ä»¶æ¨¡å¼ (Plugin Pattern)
```python
# æ™ºèƒ½ä½“æ’ä»¶åŸºç±»
class AgentPlugin(ABC):
    @abstractmethod
    def get_metadata(self) -> Dict[str, Any]: ...
    
    @abstractmethod
    def create_node(self) -> Callable: ...
    
    @abstractmethod
    def get_prompt(self) -> str: ...

# åŠ¨æ€åŠ è½½
registry = AgentPluginRegistry()
registry.discover()  # è‡ªåŠ¨å‘ç°æ’ä»¶
registry.load_all()  # åŠ è½½æ‰€æœ‰æ’ä»¶
```

#### 2. å·¥å‚æ¨¡å¼ (Factory Pattern)
```python
# LLM æä¾›å•†å·¥å‚
class LLMFactory:
    @staticmethod
    def create(
        provider: str,
        model: str,
        **kwargs
    ) -> BaseLLM:
        if provider == "openai":
            return OpenAIProvider(model, **kwargs)
        elif provider == "anthropic":
            return ClaudeProvider(model, **kwargs)
        # ...
```

#### 3. ä»“å‚¨æ¨¡å¼ (Repository Pattern)
```python
# ç±»å‹å®‰å…¨çš„æ•°æ®è®¿é—®
class AnalysisSessionRepository(BaseRepository[AnalysisSession]):
    async def get_by_ticker(
        self,
        ticker: str,
        skip: int = 0,
        limit: int = 10
    ) -> List[AnalysisSession]:
        # å®ç°ç»†èŠ‚
```

#### 4. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
```python
# ä»“ä½è°ƒæ•´ç­–ç•¥
class PositionSizingStrategy(ABC):
    @abstractmethod
    def calculate(self, capital: float, risk: float) -> float: ...

class FixedDollarStrategy(PositionSizingStrategy): ...
class PercentageStrategy(PositionSizingStrategy): ...
class KellyStrategy(PositionSizingStrategy): ...
```

---

## ğŸ“¦ è¯¦ç»†æ¨¡å—åˆ†æ

### 1. åç«¯æ ¸å¿ƒæ¨¡å—

#### 1.1 LangGraph å¤šæ™ºèƒ½ä½“ç³»ç»Ÿ

**ä½ç½®**: `packages/backend/src/tradingagents/`

**æ™ºèƒ½ä½“å·¥ä½œæµ**:
```mermaid
graph LR
    START[å¼€å§‹] --> ANALYST[åˆ†æå¸ˆå›¢é˜Ÿ]
    ANALYST --> RESEARCH[ç ”ç©¶å‘˜å›¢é˜Ÿ]
    RESEARCH --> TRADER[äº¤æ˜“å‘˜å†³ç­–]
    TRADER --> RISK[é£é™©è¯„ä¼°]
    RISK --> |é€šè¿‡| EXEC[æ‰§è¡Œäº¤æ˜“]
    RISK --> |æ‹’ç»| END[ç»“æŸ]
    EXEC --> END
```

**12+ ä¸“ä¸šè§’è‰²**:

| è§’è‰² | èŒè´£ | è¾“å…¥ | è¾“å‡º |
|------|------|------|------|
| **åŸºæœ¬é¢åˆ†æå¸ˆ** | è´¢åŠ¡åˆ†æ | è´¢æŠ¥æ•°æ® | ä¼°å€¼è¯„çº§ |
| **æŠ€æœ¯åˆ†æå¸ˆ** | å›¾è¡¨åˆ†æ | ä»·æ ¼æ•°æ® | æŠ€æœ¯ä¿¡å· |
| **æƒ…ç»ªåˆ†æå¸ˆ** | å¸‚åœºæƒ…ç»ª | ç¤¾äº¤åª’ä½“ | æƒ…ç»ªæŒ‡æ•° |
| **æ–°é—»åˆ†æå¸ˆ** | äº‹ä»¶åˆ†æ | æ–°é—»æ•°æ® | å½±å“è¯„ä¼° |
| **çœ‹æ¶¨ç ”ç©¶å‘˜** | åšå¤šè®ºè¯ | åˆ†æç»“æœ | ä¹°å…¥ç†ç”± |
| **çœ‹è·Œç ”ç©¶å‘˜** | åšç©ºè®ºè¯ | åˆ†æç»“æœ | å–å‡ºç†ç”± |
| **äº¤æ˜“å‘˜** | å†³ç­–åˆ¶å®š | ç ”ç©¶æŠ¥å‘Š | äº¤æ˜“æŒ‡ä»¤ |
| **é£é™©ç®¡ç†å‘˜** | é£é™©æ§åˆ¶ | äº¤æ˜“æŒ‡ä»¤ | é£é™©è¯„çº§ |

**æ™ºèƒ½ä½“é€šä¿¡æœºåˆ¶**:
```python
# çŠ¶æ€ä¼ é€’
class TradingState(TypedDict):
    ticker: str
    analyst_reports: List[Dict]
    research_conclusions: List[Dict]
    trade_decision: Optional[Dict]
    risk_assessment: Optional[Dict]
    
# èŠ‚ç‚¹å®ç°
def analyst_node(state: TradingState) -> TradingState:
    # æ‰§è¡Œåˆ†æé€»è¾‘
    state["analyst_reports"].append(report)
    return state
```

#### 1.2 LLM æä¾›å•†æŠ½è±¡å±‚

**ç»Ÿä¸€æ¥å£è®¾è®¡**:
```python
class BaseLLMProvider(ABC):
    # æ ¸å¿ƒæ–¹æ³•
    async def generate(self, prompt: str, **kwargs) -> str
    async def generate_structured(self, prompt: str, schema: Dict) -> Dict
    async def stream(self, prompt: str) -> AsyncIterator[str]
    async def health_check(self) -> HealthStatus
    
    # å…ƒæ•°æ®
    def get_models(self) -> List[ModelInfo]
    def get_pricing(self, model: str) -> PricingInfo
    def get_context_window(self, model: str) -> int
```

**æ”¯æŒçš„æ¨¡å‹**:
```
OpenAI:
  - gpt-4o (128K context)
  - gpt-4o-mini (128K context)
  - gpt-4-turbo (128K context)
  - gpt-3.5-turbo (16K context)

Anthropic:
  - claude-3-5-sonnet-20241022 (200K context)
  - claude-3-opus-20240229 (200K context)
  - claude-3-sonnet-20240229 (200K context)

Google:
  - gemini-2.0-flash-exp (1M context)
  - gemini-1.5-pro (2M context)
  - gemini-1.5-flash (1M context)

DeepSeek:
  - deepseek-chat (64K context)
  - deepseek-coder (64K context)

Grok:
  - grok-beta (128K context)
```

**æˆæœ¬è¿½è¸ª**:
```python
# è‡ªåŠ¨è®°å½•æ¯æ¬¡è°ƒç”¨æˆæœ¬
class AgentLLMUsage:
    agent_id: str
    session_id: str
    provider: str
    model: str
    input_tokens: int
    output_tokens: int
    total_cost: Decimal  # åŸºäºæ³¨å†Œè¡¨å®šä»·è‡ªåŠ¨è®¡ç®—
    timestamp: datetime
```

#### 1.3 æ•°æ®ä¾›åº”å•†æ’ä»¶ç³»ç»Ÿ

**ä¾›åº”å•†èƒ½åŠ›å¯¹æ¯”**:

| åŠŸèƒ½ | Alpha Vantage | yfinance | Finnhub | EODHD | AKShare |
|------|---------------|----------|---------|-------|---------|
| å®æ—¶è¡Œæƒ… | âœ… | âœ… | âœ… | âœ… | âœ… |
| å†å²æ•°æ® | âœ… | âœ… | âœ… | âœ… | âœ… |
| åŸºæœ¬é¢æ•°æ® | âœ… | âœ… | âœ… | âœ… | âœ… |
| æŠ€æœ¯æŒ‡æ ‡ | âœ… | âŒ | âœ… | âŒ | âœ… |
| æ–°é—»æ•°æ® | âŒ | âœ… | âœ… | âœ… | âœ… |
| è´¢åŠ¡æŠ¥è¡¨ | âœ… | âœ… | âœ… | âœ… | âœ… |
| å†…å¹•äº¤æ˜“ | âŒ | âŒ | âœ… | âŒ | âŒ |
| ç¤¾äº¤æƒ…ç»ª | âŒ | âŒ | âœ… | âŒ | âŒ |
| å…è´¹é¢åº¦ | 25æ¬¡/å¤© | æ— é™åˆ¶ | 60æ¬¡/åˆ† | 20æ¬¡/å¤© | æ— é™åˆ¶ |

**è·¯ç”±å’Œå›é€€ç­–ç•¥**:
```yaml
# æ™ºèƒ½è·¯ç”±é…ç½®
get_stock_data:
  strategy: cascade  # ç€‘å¸ƒå¼å›é€€
  providers:
    - alpha_vantage (ä¼˜å…ˆçº§: 1)
    - yfinance (ä¼˜å…ˆçº§: 2)
    - finnhub (ä¼˜å…ˆçº§: 3)
  retry_policy:
    max_attempts: 3
    backoff: exponential
    
get_fundamentals:
  strategy: parallel_first  # å¹¶è¡Œè¯·æ±‚å–æœ€å¿«
  providers:
    - finnhub
    - eodhd
  timeout: 5s
  
get_news:
  strategy: merge  # åˆå¹¶å¤šæºç»“æœ
  providers:
    - finnhub
    - google_news
  dedup: true
```

#### 1.4 FastAPI åº”ç”¨å±‚

**API ç«¯ç‚¹æ¶æ„**:

```
/api/v1/
â”œâ”€â”€ /sessions              # 